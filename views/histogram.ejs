<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.rawgit.com/etpinard/plotlyjs-finance/master/plotlyjs-finance.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
</head>

<body>

<select id="tickerSelector">
  <option value="Apple">Apple</option>
  <option value="British Petroleum">British Petroleum</option>
  <option value="Chevron">Chevron</option>
  <option value="Chipotle Mexican Grill">Chipotle Mexican Grill</option>
  <option value="Alphabet">Google</option>
  <option value="MacDonalds">MacDonalds</option>
  <option value="Starbucks">Starbucks</option>
  <option value="Yahoo">Yahoo</option>
  <option value="Allergan">Allergan</option>
</select>
    
    
    
  <div id="myDiv" style="width: 100%; height: 600px;"></div>


  <script>
      
       $('select').on('change', function() {
           
            console.log(tickerSelector.value);
         
        
     $('select').on('change', function() {
        test = this.value;
         $.get({
        url: '/api/ticker/' + test,
        success: function (data) {
                  console.log(data);
                  makeplot(data, data[0].name);
                  }
        });   
     });  
           
           
           
           
           
           
           
       
     });   
        
      
      
      

  $(document).ready(function() {
    $.get({
        url: '/api/ticker/<%= stockName %>',
        success: function (data1) {
                  console.log(data1);
                  makeplot(data1);
                  }
    });
  });

    function makeplot(data) {
      var x = [];

      for (var i = 0; i < data.length; i ++) {
        x[i] = data[i]["volume"];
      };

      var dataFeed = [
        {
          x: x,
          type: 'histogram'
        }
      ];

      var layout = {
        title: "Histogram of Trading Volume for " + data[0]["name"] + " between " + data[data.length-1]["date"].substring(0,10) + " and " + data[0]["date"].substring(0,10),
        xaxis: {
          title: "Days grouped by trading volume"
        },
        yaxis: {
          title: "Number of days in trading range"
        },
        bargap: 0.1
      };

      Plotly.newPlot('myDiv', dataFeed, layout);
    };

  </script>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- <script defer src="../public/multiple.js"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
</head>

<body>

<form id="myForm" action="form_action.asp">
  <h4>Choose Ticker 1</h4>
  <select id="tickerSelector1">
    <option value="Apple">Apple</option>
    <option value="British Petroleum">British Petroleum</option>
    <option value="Chevron">Chevron</option>
    <option value="Chipotle Mexican Grill">Chipotle Mexican Grill</option>
    <option value="Alphabet">Google</option>
    <option value="MacDonalds">MacDonalds</option>
    <option value="Starbucks">Starbucks</option>
    <option value="Yahoo">Yahoo</option>
    <option value="Allergan">Allergan</option>
  </select>

  <h4>Choose Ticker 2</h4>
  <select id="tickerSelector2">
    <option value="Apple">Apple</option>
    <option value="British Petroleum">British Petroleum</option>
    <option value="Chevron">Chevron</option>
    <option value="Chipotle Mexican Grill">Chipotle Mexican Grill</option>
    <option value="Alphabet">Google</option>
    <option value="MacDonalds">MacDonalds</option>
    <option value="Starbucks">Starbucks</option>
    <option value="Yahoo">Yahoo</option>
    <option value="Allergan">Allergan</option>
  </select>
  <input id="submitButton" type="button" value="SUBMIT">
</form>

  <div id="myDiv" style="width: 100%; height: 500px;"></div>
</body>


<script>

$(document).ready(function() {

var ticker1;
var ticker2;
  // when submit button is clicked, run the function below
  $('#submitButton').on('click', function(){

  // get the values currently in ticker1 and ticker2
    ticker1 = $('#tickerSelector1').val();
    ticker2 = $('#tickerSelector2').val();
  //
  // console.log(ticker1);
  // console.log(ticker2);

  var type1 = {};
  var type2 = {};

  // input these 2 values to the main graphing function
      $.get({
          url: '/api/ticker/' + ticker1,
          success: function (data1) {
                      // console.log(data1);
                      type1 = data1;

                      $.get({
                          url: '/api/ticker/' + ticker2,
                          success: function (data2) {
                                      // console.log(data2);
                                      type2 = data2;
                                      plotMe(type1, type2);
                                    }
                      });
                    }
      });

  });


  // first time the page loads

  var type1 = {};
  var type2 = {};


    $.get({
        url: '/api/ticker/<%= stockName1 %>',
        success: function (data1) {
                    // console.log(data1);
                    type1 = data1;

                    $.get({
                        url: '/api/ticker/<%= stockName2 %>',
                        success: function (data2) {
                                    // console.log(data2);
                                    type2 = data2;
                                    plotMe(type1, type2);
                                  }
                    });
                  }
    });

  // $.get('/api/ticker/<%=stockName2%>', function(data2) {
  //     console.log(data2)
  //     type2 = data2;
  //     plotMe(type1, type2);
  //   });
  // });


    function plotMe(data1, data2){

        x_val = [];
        y_val = [];

        for (var i = 0; i < data1.length; i++) {
            	x_val.push(data1[i]["date"]);
              y_val.push(data1[i]["price"]);
        };


        x_val2 = [];
        y_val2 = [];

        for (var i = 0; i < data2.length; i++) {
              x_val2.push(data2[i]["date"]);
              y_val2.push(data2[i]["price"]);
        };

        // console.log(x_val);
        // console.log(y_val);
        //
        // console.log(x_val2);
        // console.log(y_val2);

        var dataCombine = [{x:x_val, y:y_val, name: data1[0].name, type: 'scatter'}, { x:x_val, y:y_val2, name: data2[0].name, yaxis: 'y2', type: 'scatter'}];

        var layout = {
            title: data1[0]["name"] + " vs " + data2[0]["name"],
            yaxis: {
                    title: data1[0].name + " Prices",
                    titlefont: {color: 'rgb(39, 0, 170)'},
                    tickfont: {color: 'rgb(89, 30, 250)'}
                  },
            yaxis2: {
              title: data2[0].name + " Prices",
              titlefont: {color: 'rgb(255, 137, 0)'},
              tickfont: {color: 'rgb(186, 100, 0)'},
              overlaying: 'y',
              side: 'right'
            },
            xaxis: { title: "Date",
                    tickformat: "%x"
                   }
            };

        Plotly.newPlot('myDiv', dataCombine, layout);
    };

});

  </script>
</html>
